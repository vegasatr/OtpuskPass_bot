#!/bin/bash

# –°–∫—Ä–∏–ø—Ç –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è/–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –±–∞–∑–æ–≤—ã—Ö –∫–≤–∞—Ä—Ç–∏—Ä –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö
# –ü—Ä–æ—Ö–æ–¥–∏—Ç –ø–æ –≤—Å–µ–º –≥–æ—Ä–æ–¥–∞–º, –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Ñ–∞–π–ª—ã, –∑–∞–≥—Ä—É–∂–∞–µ—Ç –≤–∏–¥–µ–æ –∏ –¥–æ–±–∞–≤–ª—è–µ—Ç/–æ–±–Ω–æ–≤–ª—è–µ—Ç –∑–∞–ø–∏—Å–∏ –≤ –ë–î.

set -e # –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø—Ä–∏ –ª—é–±–æ–π –æ—à–∏–±–∫–µ

# –¶–≤–µ—Ç–∞ –¥–ª—è –≤—ã–≤–æ–¥–∞
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
BLUE='\033[0;34m'
NC='\033[0m' # No Color

# –ü—É—Ç—å –∫ –∫–æ—Ä–Ω–µ–≤–æ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –ø—Ä–æ–µ–∫—Ç–∞
PROJECT_ROOT=$(dirname "$(dirname "$(readlink -f "$0")")")

# –ü—É—Ç—å –∫ Python-—Å–∫—Ä–∏–ø—Ç—É –ª–æ–≥–∏–∫–∏
PYTHON_SCRIPT="$PROJECT_ROOT/add_property/add_base_apartment_logic.py"

echo -e "${BLUE}--- –ó–∞–ø—É—Å–∫ –ø—Ä–æ—Ü–µ—Å—Å–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è/–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –±–∞–∑–æ–≤—ã—Ö –∫–≤–∞—Ä—Ç–∏—Ä ---${NC}"

# 1. –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ Python-—Å–∫—Ä–∏–ø—Ç–∞ –ª–æ–≥–∏–∫–∏
echo -e "${YELLOW}üêç –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ Python-—Å–∫—Ä–∏–ø—Ç–∞ –ª–æ–≥–∏–∫–∏: ${PYTHON_SCRIPT}${NC}"
if [ ! -f "$PYTHON_SCRIPT" ]; then
    echo -e "${RED}‚ùå –û–®–ò–ë–ö–ê: Python-—Å–∫—Ä–∏–ø—Ç –ª–æ–≥–∏–∫–∏ '$PYTHON_SCRIPT' –Ω–µ –Ω–∞–π–¥–µ–Ω.${NC}"
    echo -e "${RED}–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —Å–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª '$PYTHON_SCRIPT' —Å–æ –≤—Å–µ–π –ª–æ–≥–∏–∫–æ–π.${NC}"
    exit 1
fi

# 2. –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ
echo -e "${YELLOW}üêç –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ...${NC}"
if [ -d "$PROJECT_ROOT/venv" ]; then
    source "$PROJECT_ROOT/venv/bin/activate"
    echo -e "${GREEN}‚úÖ –í–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–æ.${NC}"
else
    echo -e "${RED}‚ùå –û–®–ò–ë–ö–ê: –í–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ 'venv' –Ω–µ –Ω–∞–π–¥–µ–Ω–æ –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞.${NC}"
    echo -e "${RED}–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —Å–æ–∑–¥–∞–π—Ç–µ –µ–≥–æ: 'python3 -m venv venv' –∏ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏: 'pip install -r requirements.txt'.${NC}"
    exit 1
fi

# 3. –í—ã–∑—ã–≤–∞–µ–º Python-—Å–∫—Ä–∏–ø—Ç –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –≤—Å–µ–π –ª–æ–≥–∏–∫–∏
echo -e "${BLUE}‚öôÔ∏è –ó–∞–ø—É—Å–∫ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∫–≤–∞—Ä—Ç–∏—Ä...${NC}"
if ! python3 "$PYTHON_SCRIPT"; then
    echo -e "${RED}üî• –ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ –∫–≤–∞—Ä—Ç–∏—Ä. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –≤—ã—à–µ.${NC}"
    deactivate
    exit 1
fi

deactivate # –î–µ–∞–∫—Ç–∏–≤–∏—Ä—É–µ–º –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ
echo -e "${BLUE}--- –ü—Ä–æ—Ü–µ—Å—Å –∑–∞–≤–µ—Ä—à–µ–Ω ---${NC}" 